# Multi-factor Authentication

Rehive allows for the use of token-based or sms-otp based multi-factor
authentication, both of which can be fully managed and utilised by the API.

## Multi-factor Status

> Status request

```shell
curl https://www.rehive.com/api/3/auth/mfa/
  -X GET
  -H "Content-Type: application/json"
```

> Status response

```shell
  {
    "status": "success"
    "data": {
        "sms": false,
        "token": false
    }
  }
```

Provides the statuses for SMS and Token bases authentication. When successfully 
enabled, the respective type will be `true`.

#### Endpoint

`https://rehive.com/api/3/auth/mfa/`

## SMS Authentication

> SMS request

```shell
curl https://www.rehive.com/api/3/auth/mfa/sms/
  -X POST
  -H "Content-Type: application/json"
  -D '{"mobile_number": "+27000000000"}'
```

> SMS response

```shell
  {
    "status": "success"
    "data": {
        "mobile_number": "+27000000000",
        "confirmed": false
      },
    }
  }
```

By posting to this endpoint you are starting the verification process for enabling SMS authentication. At this point an OTP will be sent to the mobile number that was
posted. Use this OTP to verify the mobile number at the [Verify endpoint](#verify-multi-factor-authentication).

#### Endpoint

`https://rehive.com/api/3/auth/mfa/sms`

#### Fields

Field | Description | Default | Required
--- | --- | --- | ---
`mobile_number` | Mobile Number | null | true

`https://rehive.com/api/3/auth/mfa/`

## Send SMS

> Send SMS request

```shell
curl https://www.rehive.com/api/3/auth/mfa/sms/send/
  -X POST
  -H "Content-Type: application/json"
```

> Send SMS response

```shell
  {
    "status": "success"
    "data": {
        "mobile_number": "+27000000000",
        "confirmed": false
      },
    }
  }
```

Sends and OTP to the mobile number that was used to enabled SMS based multi-factor authentication.

<aside class="notice">
    This is only required if, for some reason, the automatic SMS was not sent or a new OTP needs to be generated and sent.
</aside>  

#### Endpoint

`https://rehive.com/api/3/auth/mfa/sms`

#### Fields

Field | Description | Default | Required
--- | --- | --- | ---
`mobile_number` | Mobile Number | null | true

`https://rehive.com/api/3/auth/mfa/`

## Token Authentication

> Token request

```shell
curl https://www.rehive.com/api/3/auth/mfa/token/
  -X POST
  -H "Content-Type: application/json"
```

> Token response

```shell
  {
    "status": "success"
    "data": {
        "otpauth_url": "otpauth://totp/Test%20Company%201%3A%20test1%40rehive.com?secret=KJN27K32SJOMLXZJ5V76UW6AWRKF6KWB&digits=6&issuer=Test+Company+1",
        "issuer": "Test Company 1",
        "account": "test1@rehive.com",
        "key": "KJN27K32SJOMLXZJ5V76UW6AWRKF6KWB"
    }
  }
```

By posting to this endpoint you are starting the verification process for enabling token based authentication. The response contains data that can be used with 
apps such as Google Authenticator. Use the `otpauth_url` to generate a QR code. For more information on how to generate a QR code, check out the [Google Charts API](https://developers.google.com/chart/infographics/docs/qr_codes).
The rest of the data can be used for manual entry into the app. Use the token OTP
generated by the app to finalise the verification process at the [Verify endpoint](#verify-multi-factor-authentication).

#### Endpoint

`https://rehive.com/api/3/auth/mfa/token`

#### Response Fields

Field | Description 
--- | --- 
`otpauth_url` | url used for QR generation
`issuer` | The company name in Rehive
`account` | The user email address enabling multi-factor authentication
`key` | Secret key

## Verify Multi-factor Authentication

> Verify request

```shell
curl https://www.rehive.com/api/3/auth/mfa/verify/
  -X POST
  -H "Content-Type: application/json"
  -D '{"token": "123456"}'
```

> Verify response

```shell
  {
    "status": "success"
  }
```

This endpoint finalises the verification process for multi-factor authentication.
Once you successfully verify the SMS OTP or the token OTP, your multi-factor authentication will now be enabled. 

<aside class="notice">
    This endpoint is used to finalise the verification process, as well as verifying a token after login.
</aside>  

#### Endpoint

`https://rehive.com/api/3/auth/mfa/verify`

#### Fields

Field | Description | Default | Required
--- | --- | --- | ---
`token` | Token or SMS OTP | null | true